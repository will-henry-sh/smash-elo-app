<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smash Ultimate Leaderboard</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>

  <body>
    {% macro colored(name) -%} {% if rank_map.get(name) == 1 %}
    <span class="rank-gold">{{ name }}</span>
    {% elif rank_map.get(name) == 2 %}
    <span class="rank-silver">{{ name }}</span>
    {% elif rank_map.get(name) == 3 %}
    <span class="rank-bronze">{{ name }}</span>
    {% else %}
    <span class="rank-normal">{{ name }}</span>
    {% endif %} {%- endmacro %}

    <nav class="top-nav">
      <a href="/matches">Matches</a>
      <a href="/leaderboard">Leaderboard</a>
      <a href="/badges">Badge Info</a>
    </nav>

    <div class="container leaderboard-container">
      <h1 class="page-title">Smash Leaderboard</h1>

      <table>
        <tr>
          <th>Rank</th>
          <th class="ws-col"></th>
          <th>Player</th>
          <th>Global ELO</th>
        </tr>

        {% for player, rating, char_map in rows %}
        <tr>
          <!-- Rank -->
          <td class="rank-col">
            {% if loop.index == 1 %}
            <span class="rank-gold">{{ loop.index }}</span>
            {% elif loop.index == 2 %}
            <span class="rank-silver">{{ loop.index }}</span>
            {% elif loop.index == 3 %}
            <span class="rank-bronze">{{ loop.index }}</span>
            {% else %}
            <span class="rank-normal">{{ loop.index }}</span>
            {% endif %}
          </td>

          <td class="ws-col">
            {% set streak = win_streaks.get(player, 0) -%} {% if streak > 1 -%}
            <img src="/static/icons/win_streak.png" class="ws-icon" />
            <span class="ws-number">{{ streak }}</span>
            {%- endif %}
          </td>

          <!-- Player -->
          <td class="player-cell">
            <!-- NAME (centered perfectly under Player) -->
            <a href="/player/{{ player }}" class="player-name-block">
              <span
                class="player-name {{ 'rank-gold' if loop.index==1 else
                                         'rank-silver' if loop.index==2 else
                                         'rank-bronze' if loop.index==3 else
                                         'rank-normal' }}"
              >
                {{ player }}
              </span>
            </a>

            <!-- KEY (does NOT affect centering) -->
            {% if player in admin_usernames %}
            <img src="/static/icons/admin_key.png" class="admin-key-icon" />
            {% endif %}
          </td>

          <!-- Global ELO -->
          <td class="rating-value">{{ rating }}</td>
        </tr>
        {% endfor %}
      </table>

      <!-- RECENT MATCH SECTION (Safe even if last_match is None) -->

      <h2 style="text-align: center; margin-top: 40px">
        Recent Matches (Last 20)
      </h2>

      <div class="recent-matches-list">
        {% for m in recent_matches %}
        <div class="result-box recent-match-card">
          {# Player 1 #}
          <p>
            <strong>{{ colored(m.p1) }}</strong>
            ({{ m.c1 }}) {% if m.diff1 is defined %} : {{ m.new1 }}
            <span class="{{ 'green' if m.diff1 > 0 else 'red' }}">
              {% if m.diff1 > 0 %}+{{ m.diff1 }}{% else %}{{ m.diff1 }}{% endif
              %}
            </span>
            {% endif %}
          </p>

          {# Player 2 #}
          <p>
            <strong>{{ colored(m.p2) }}</strong>
            ({{ m.c2 }}) {% if m.diff2 is defined %} : {{ m.new2 }}
            <span class="{{ 'green' if m.diff2 > 0 else 'red' }}">
              {% if m.diff2 > 0 %}+{{ m.diff2 }}{% else %}{{ m.diff2 }}{% endif
              %}
            </span>
            {% endif %}
          </p>

          {# Winner #}
          <p style="margin-top: 10px">
            Winner: {% if m.winner == "p1" %}
            <strong>{{ colored(m.p1) }}</strong>
            {% else %}
            <strong>{{ colored(m.p2) }}</strong>
            {% endif %}
          </p>

          {# Date (if timestamps added) #} {% if m.timestamp %}
          <p class="recent-date">{{ m.timestamp }}</p>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
  </body>
</html>
